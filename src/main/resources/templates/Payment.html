<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pure Healthy Eats - Secure Payment</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        :root { --background: #f8fafc; --foreground: #1f2937; --muted-foreground: #6b7280; --primary: #10B981; --primary-foreground: #ffffff; --card: #ffffff; --border: #e2e8f0; }
        .text-primary { color: var(--primary); } .text-green-700 { color: #047857; }
        .card { background-color: var(--card); border-radius: 0.5rem; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06); border: 1px solid var(--border); }
        .button { display: inline-flex; align-items: center; justify-content: center; border-radius: 0.375rem; font-weight: 500; transition: all 0.2s ease-in-out; cursor: pointer; padding: 0.625rem 1rem; font-size: 0.875rem; text-align: center; }
        .button.variant-hero { background-color: var(--primary); color: var(--primary-foreground); }
        .button.variant-hero:hover { background-color: #059669; }
        .separator { height: 1px; background-color: var(--border); width: 100%; margin: 1rem 0; }
    </style>
</head>
<body class="min-h-screen bg-background">
    <header class="bg-white shadow-md p-4 sticky top-0 z-50">
        <nav class="container mx-auto flex justify-between items-center">
            <a th:href="@{/}" class="text-2xl font-bold text-green-700">Pure Healthy Eats</a>
        </nav>
    </header>
    <main class="pt-20 pb-12 px-6">
        <div class="container mx-auto max-w-4xl">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold mb-2 flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="inline w-8 h-8 mr-2"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>Secure Payment</h1>
                <p class="text-muted-foreground flex items-center justify-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 text-green-500"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>Your payment information is secure and encrypted</p>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2">
                    <div class="card p-6">
                        <h2 class="text-xl font-semibold mb-4 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>Payment Details</h2>
                        <div class="text-center text-muted-foreground p-8 mt-4 border-2 border-dashed rounded-lg">
                            <p>Click the "Pay" button to open the secure payment gateway.</p>
                            <p class="text-sm mt-2">You can use UPI, Cards, Netbanking, and more.</p>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="card sticky top-24">
                        <div class="p-6">
                            <h2 class="text-xl font-semibold mb-4">Order Summary</h2>
                            <div class="space-y-2">
                                <div th:each="item : ${order.orderItems}" class="flex justify-between">
                                    <span><span th:text="${item.quantity}"></span>x <span th:text="${item.product.name}"></span></span>
                                    <span th:text="'₹' + ${#numbers.formatDecimal(item.price * item.quantity, 1, 2)}"></span>
                                </div>
                            </div>
                            <div class="separator"></div>
                            <div class="flex justify-between font-semibold text-lg">
                                <span>Total</span>
                                <span class="text-primary" th:text="'₹' + ${#numbers.formatDecimal(order.totalAmount, 1, 2)}"></span>
                            </div>
                            <button id="pay-btn" class="button w-full variant-hero mt-6"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 mr-2"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>Pay <span th:text="'₹' + ${#numbers.formatDecimal(order.totalAmount, 1, 2)}"></span></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script th:inline="javascript">
        document.getElementById('pay-btn').onclick = function(e) {
            var options = {
                "key": /*[[${razorpayKeyId}]]*/ '',
                "amount": /*[[${amount}]]*/ '0',
                "currency": "INR",
                "name": "Pure Healthy Eats",
                "description": "Healthy Meal Order",
                "order_id": /*[[${razorpayOrderId}]]*/ '',
                "handler": function (response){
                    window.location.href = "/track-order";
                },
                "prefill": {
                    "name": /*[[${order.user.fullName}]]*/ '',
                    "email": /*[[${order.user.email}]]*/ '',
                    "contact": /*[[${order.user.phoneNumber}]]*/ ''
                },
                "theme": {
                    "color": "#10B981"
                }
            };
            var rzp1 = new Razorpay(options);
            rzp1.on('payment.failed', function (response){
                alert("Payment Failed: " + response.error.description);
            });
            rzp1.open();
            e.preventDefault();
        }
    </script>
</body>
</html>
